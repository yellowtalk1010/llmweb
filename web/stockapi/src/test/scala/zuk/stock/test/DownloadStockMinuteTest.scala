package zuk.stock.test

import org.apache.commons.lang3.StringUtils
import org.scalatest.funsuite.AnyFunSuite
import zuk.stockapi.{DownloadMinuteStock, LoaderLocalStockData, StockApiVo}

import java.util.concurrent.{Executors, TimeUnit}
import java.util.concurrent.atomic.AtomicInteger
import scala.jdk.CollectionConverters.*

class DownloadStockMinuteTest extends AnyFunSuite {

  test("下载"){
    LoaderLocalStockData.loadToken()
//    val stocks = getAllData()
    val stocks = LoaderLocalStockData.STOCKS.asScala.toList
    DownloadMinuteStock.run(stocks)
  }

  def getAllData(): List[StockApiVo] = {

    val list = """

      |001317
      |600728
      |603322
      |688215
      |600619
      |603726
      |688312
      |603059
      |600577
      |300260
      |300638
      |300227
      |300371
      |300236
      |300846
      |688048
      |301326

      |300250
      |688081
      |000021
      |300085
      |002347
      |002273
      |600895
      |002428
      |603726
      |300911
      |688312
      |603059
      |603668
      |002145
      |300371
      |300456
      |300354
      |300054
      |002222
      |001298
      |603296
      |301587
      |688449

      |002276
      |605318
      |603216
      |688678
      |002647
      |000810
      |603798
      |002716
      |002364
      |000036
      |000603
      |300084
      |300190
      |600819
      |002244
      |601138
      |601208
      |300756
      |603618
      |000426
      |600531
      |600052
      |688008
      |688178
      |000069
      |002718
      |300388
      |600892
      |002042
      |600635
      |002303
      |605255
      |002429
      |600167
      |603398
      |002059
      |600400
      |002715
      |603843
      |603686
      |002101
      |002563
      |002475
      |601598
      |600641
      |002549
      |688195
      |603633
      |300620
      |688090
      |688228
      |300475
      |002463
      |600071
      |605128
      |688766
      |002654
      |300316
      |002918
      |002690
      |000572
      |688123
      |300745
      |605136
      |300432
      |002708
      |301021
      |300857
      |301228
      |688325
      |301150
      |688400
      |001309
      |301308
      |301227
      |688073
      |688376
      |601022
      |301391
      |688525
      |688627
      |688610
      |301489
      |001358
      |301607
      |300984
      |688411
      |001221

      |300120
      |002276
      |605318
      |603755
      |603216
      |000892
      |688678
      |002155
      |000811
      |605289
      |002716
      |002364
      |000729
      |000603
      |600265
      |300190
      |600819
      |603993
      |601138
      |605338
      |300756
      |603618
      |603790
      |002233
      |002016
      |688109
      |603863
      |688248
      |600052
      |688008
      |000069
      |000609
      |600892
      |002042
      |300408
      |600635
      |300750
      |002429
      |603398
      |002064
      |600400
      |601111
      |002715
      |600226
      |600333
      |603843
      |002563
      |600641
      |002549
      |688195
      |002289
      |300620
      |688585
      |688228
      |300475
      |002463
      |002243
      |603444
      |001215
      |605128
      |002654
      |002154
      |300905
      |300316
      |300814
      |300371
      |605196
      |002690
      |688613
      |000988
      |300219
      |002584
      |300857
      |603978
      |300223
      |688234
      |301150
      |688400
      |301308
      |301369
      |301389
      |001333
      |301391
      |688147
      |001358
      |688411

      |002654
      |301391
      |300620
      |300190
      |001358
      |002463
      |000603
      |600400
      |600819
      |688195
      |603398
      |603843
      |600635
      |603618
      |688411
      |605128
      |002563
      |002715
      |002364
      |688400
      |000069
      |688228
      |600892
      |300475
      |002716
      |605318
      |600052
      |002549
      |002042
      |300756
      |688008
      |300371
      |601138
      |002690
      |603216
      |300857
      |002429
      |301150
      |600641
      |300316
      |301308
      |688678
      |002276
      |
      |""".stripMargin


    val sets = list.split("\r\n").filter(e=>StringUtils.isNotEmpty(e) && e.size==6).toSet
    LoaderLocalStockData.STOCKS.asScala.filter(e=>sets.contains(e.getApi_code)).toList
  }

}
